<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Web requests with HTTP - CrSFML Tutorials</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../codehilite.css" rel="stylesheet" />
  <link href="../style.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Web requests with HTTP";
    var mkdocs_page_input_path = "network/http.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> CrSFML Tutorials</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">System module</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../system/time.html">Handling time</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../system/thread.html">Threads</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../system/stream.html">User data streams</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Window module</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../window/window.html">Opening and managing an SFML window</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../window/events.html">Events explained</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../window/inputs.html">Keyboard, mouse and joysticks</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../window/opengl.html">Using OpenGL in an SFML window</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Graphics module</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/draw.html">Drawing 2D stuff</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/sprite.html">Sprites and textures</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/text.html">Text and fonts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/shape.html">Shapes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/vertex-array.html">Designing your own entities with vertex arrays</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/transform.html">Position, rotation, scale: transforming entities</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/shader.html">Adding special effects with shaders</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/view.html">Controlling the 2D camera with views</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Audio module</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../audio/sounds.html">Playing sounds and music</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../audio/recording.html">Recording audio</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../audio/streams.html">Custom audio streams</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../audio/spatialization.html">Spatialization: Sounds in 3D</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Network module</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="socket.html">Communication using sockets</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="packet.html">Using packets</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="http.html">Web requests with HTTP</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sfhttp">SF::Http</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#requests">Requests</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#responses">Responses</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-sending-scores-to-an-online-server">Example: sending scores to an online server</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="ftp.html">File transfers with FTP</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">CrSFML Tutorials</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Network module &raquo;</li>
        
      
    
    <li>Web requests with HTTP</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/oprypin/crsfml/blob/tutorials/network/http.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="web-requests-with-http">Web requests with HTTP</h1>
<p>Relevant example: <strong><a href="https://github.com/oprypin/crsfml/tree/master/examples/shader.cr">shader</a></strong></p>
<h2 id="introduction">Introduction</h2>
<p>CrSFML provides a simple HTTP client class which you can use to communicate with HTTP servers. "Simple" means that it supports the most basic features of HTTP: POST, GET and HEAD request types, accessing HTTP header fields, and reading/writing the pages body.</p>
<p>If you need more advanced features, such as secured HTTP (HTTPS) for example, you're better off using a true HTTP library.</p>
<p>For basic interaction between your program and an HTTP server, it should be enough.</p>
<h2 id="sfhttp">SF::Http</h2>
<p>To communicate with an HTTP server you must use the <a href="http://oprypin.github.io/crsfml/api/SF/Http.html">Http</a> class.</p>
<div class="codehilite"><pre><span></span><code><span class="n">http</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Http</span><span class="o">.</span><span class="n">new</span>
<span class="n">http</span><span class="o">.</span><span class="n">set_host</span><span class="p">(</span><span class="s2">&quot;http://example.org/&quot;</span><span class="p">)</span>

<span class="c1"># or</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Http</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;http://example.org/&quot;</span><span class="p">)</span>
</code></pre></div>


<p>Note that setting the host doesn't trigger any connection. A temporary connection is created for each request.</p>
<p>The only other method in <a href="http://oprypin.github.io/crsfml/api/SF/Http.html">Http</a>, sends requests. This is basically all that the class does.</p>
<div class="codehilite"><pre><span></span><code><span class="n">request</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Http</span><span class="o">::</span><span class="n">Request</span><span class="o">.</span><span class="n">new</span>
<span class="c1"># fill the request...</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</code></pre></div>


<h2 id="requests">Requests</h2>
<p>An HTTP request, represented by the <a href="http://oprypin.github.io/crsfml/api/SF/Http/Request.html">Http::Request</a> class, contains the following information:</p>
<ul>
<li>The method: POST (send content), GET (retrieve a resource), HEAD (retrieve a resource header, without its body)</li>
<li>The URI: the address of the resource (page, image, ...) to get/post, relative to the root directory</li>
<li>The HTTP version (it is 1.0 by default but you can choose a different version if you use specific features)</li>
<li>The header: a set of fields with key and value</li>
<li>The body of the page (used only with the POST method)</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">request</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Http</span><span class="o">::</span><span class="n">Request</span><span class="o">.</span><span class="n">new</span>
<span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Http</span><span class="o">::</span><span class="n">Request</span><span class="o">::</span><span class="n">Post</span>
<span class="n">request</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;/index.html&quot;</span>
<span class="n">request</span><span class="o">.</span><span class="n">set_http_version</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># HTTP 1.1</span>
<span class="n">request</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;From&quot;</span><span class="p">,</span> <span class="s2">&quot;me&quot;</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;para1=value1&amp;param2=value2&quot;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</code></pre></div>


<p>SFML automatically fills mandatory header fields, such as "Host", "Content-Length", etc. You can send your requests without worrying about them. SFML will do its best to make sure they are valid.</p>
<h2 id="responses">Responses</h2>
<p>If the <a href="http://oprypin.github.io/crsfml/api/SF/Http.html">Http</a> class could successfully connect to the host and send the request, a response is sent back and returned to the user, encapsulated in an instance of the <a href="http://oprypin.github.io/crsfml/api/SF/Http/Response.html">Http::Response</a> class. Responses contain the following members:</p>
<ul>
<li>A status code which precisely indicates how the server processed the request (OK, redirected, not found, etc.)</li>
<li>The HTTP version of the server</li>
<li>The header: a set of fields with key and value</li>
<li>The body of the response</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="nb">puts</span> <span class="s2">&quot;Status: </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">puts</span> <span class="s2">&quot;HTTP version: </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">major_http_version</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">minor_http_version</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">puts</span> <span class="s2">&quot;Content-Type header: &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">)</span>
<span class="nb">puts</span> <span class="s2">&quot;Body:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
</code></pre></div>


<p>The status code can be used to check whether the request was successfully processed or not: codes 2xx represent success, codes 3xx represent a redirection, codes 4xx represent client errors, codes 5xx represent server errors, and codes 10xx represent SFML specific errors which are <em>not</em> part of the HTTP standard.</p>
<h2 id="example-sending-scores-to-an-online-server">Example: sending scores to an online server</h2>
<p>Here is a short example that demonstrates how to perform a simple task: Sending a score to an online database.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">send_score</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># prepare the request</span>
  <span class="n">request</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Http</span><span class="o">::</span><span class="n">Request</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;/send-score.html&quot;</span><span class="p">,</span> <span class="no">SF</span><span class="o">::</span><span class="n">Http</span><span class="o">::</span><span class="n">Request</span><span class="o">::</span><span class="n">Post</span><span class="p">)</span>

  <span class="c1"># encode the parameters in the request body</span>
  <span class="n">request</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;name=&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&amp;score=&quot;</span> <span class="o">+</span> <span class="n">score</span>

  <span class="c1"># send the request</span>
  <span class="n">http</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Http</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;http://www.myserver.com/&quot;</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

  <span class="c1"># check the status</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">ok?</span>
    <span class="c1"># check the contents of the response</span>
    <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">&quot;request failed&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>


<p>Of course, this is a very simple way to handle online scores. There's no protection: Anybody could easily send a false score. A more robust approach would probably involve an extra parameter, like a hash code that ensures that the request was sent by the program. That is beyond the scope of this tutorial.</p>
<p>And finally, here is a very simple example of what the PHP page on server might look like.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<span class="nv">$score</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">];</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">write_to_database</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$score</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// this is not a PHP tutorial :)</span>
    <span class="k">echo</span> <span class="s1">&#39;name and score added!&#39;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;failed to write name and score to database...&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ftp.html" class="btn btn-neutral float-right" title="File transfers with FTP">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="packet.html" class="btn btn-neutral" title="Using packets"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/oprypin/crsfml/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="packet.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="ftp.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
