<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>User data streams - CrSFML Tutorials</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../codehilite.css" rel="stylesheet" />
  <link href="../style.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "User data streams";
    var mkdocs_page_input_path = "system/stream.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> CrSFML Tutorials</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">System module</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="time.html">Handling time</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="thread.html">Threads</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="stream.html">User data streams</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inputstream">InputStream</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fileinputstream-and-memoryinputstream">FileInputStream and MemoryInputStream</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-an-inputstream">Using an InputStream</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#common-mistakes">Common mistakes</a>
    </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Window module</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../window/window.html">Opening and managing an SFML window</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../window/events.html">Events explained</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../window/inputs.html">Keyboard, mouse and joysticks</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../window/opengl.html">Using OpenGL in an SFML window</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Graphics module</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/draw.html">Drawing 2D stuff</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/sprite.html">Sprites and textures</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/text.html">Text and fonts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/shape.html">Shapes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/vertex-array.html">Designing your own entities with vertex arrays</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/transform.html">Position, rotation, scale: transforming entities</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/shader.html">Adding special effects with shaders</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../graphics/view.html">Controlling the 2D camera with views</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Audio module</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../audio/sounds.html">Playing sounds and music</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../audio/recording.html">Recording audio</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../audio/streams.html">Custom audio streams</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../audio/spatialization.html">Spatialization: Sounds in 3D</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Network module</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../network/socket.html">Communication using sockets</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../network/packet.html">Using packets</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../network/http.html">Web requests with HTTP</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../network/ftp.html">File transfers with FTP</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">CrSFML Tutorials</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>System module &raquo;</li>
        
      
    
    <li>User data streams</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/oprypin/crsfml/blob/tutorials/system/stream.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="user-data-streams">User data streams</h1>
<h2 id="introduction">Introduction</h2>
<p>SFML has several resource classes: images, fonts, sounds, etc. In most programs, these resources will be loaded from files, with the help of their <code>from_file</code> class method. In a few other situations, resources will be packed directly into the executable or in a big data file, and loaded from memory with <code>from_memory</code>. These methods cover <em>almost</em> all the possible use cases -- but not all.</p>
<p>Sometimes you want to load files from unusual places, such as a compressed/encrypted archive, or a remote network location for example. For these special situations, CrSFML provides a third loading method: <code>from_stream</code>. This method reads data using an abstract <a href="http://oprypin.github.io/crsfml/api/SF/InputStream.html">InputStream</a> interface, which allows you to provide your own implementation of a stream class that works with SFML.</p>
<p>In this tutorial you'll learn how to write and use your own derived input stream.</p>
<h2 id="inputstream">InputStream</h2>
<p>The <a href="http://oprypin.github.io/crsfml/api/SF/InputStream.html">InputStream</a> class declares four virtual methods:</p>
<div class="crystal codehilite"><pre><span></span><code><span class="k">abstract</span> <span class="k">class</span> <span class="nc">InputStream</span>
  <span class="k">abstract</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">data</span> <span class="p">:</span> <span class="nb">Slice</span><span class="p">)</span> <span class="p">:</span> <span class="nb">Int64</span>
  <span class="k">abstract</span> <span class="k">def</span> <span class="nf">seek</span><span class="p">(</span><span class="n">position</span> <span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">:</span> <span class="nb">Int64</span>
  <span class="k">abstract</span> <span class="k">def</span> <span class="nf">tell</span><span class="p">()</span> <span class="p">:</span> <span class="nb">Int64</span>
  <span class="k">abstract</span> <span class="k">def</span> <span class="nf">size</span><span class="p">()</span> <span class="p">:</span> <span class="nb">Int64</span>
<span class="k">end</span>
</code></pre></div>

<p><strong>read</strong> must extract <em>buffer.size</em> bytes of data from the stream, and copy them to the supplied <em>buffer</em> slice. It returns the number of bytes read, or -1 on error.</p>
<p><strong>seek</strong> must change the current reading position in the stream. Its <em>position</em> argument is the absolute byte offset to jump to (so it is relative to the beginning of the data, not to the current position). It returns the new position, or -1 on error.</p>
<p><strong>tell</strong> must return the current reading position (in bytes) in the stream, or -1 on error.</p>
<p><strong>size</strong> must return the total size (in bytes) of the data which is contained in the stream, or -1 on error.</p>
<p>To create your own working stream, you must implement every one of these four methods according to their requirements.</p>
<h2 id="fileinputstream-and-memoryinputstream">FileInputStream and MemoryInputStream</h2>
<p><code>SF::FileInputStream</code> provides the read-only data stream of a file, while <code>SF::MemoryInputStream</code> serves the read-only stream from memory. Both are derived from <code>SF::InputStream</code>.</p>
<h2 id="using-an-inputstream">Using an InputStream</h2>
<p>Using a custom stream class is straight-forward: instantiate it, and pass it to the <code>from_stream</code> class method of the object that you want to load.</p>
<div class="crystal codehilite"><pre><span></span><code><span class="n">stream</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">FileInputStream</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;image.png&quot;</span><span class="p">)</span>
<span class="n">texture</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Texture</span><span class="o">.</span><span class="n">from_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</code></pre></div>

<div class="crystal codehilite"><pre><span></span><code><span class="n">stream</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">FileInputStream</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;music.ogg&quot;</span><span class="p">)</span>
<span class="n">music</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Music</span><span class="o">.</span><span class="n">from_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</code></pre></div>

<div class="crystal codehilite"><pre><span></span><code><span class="n">string</span> <span class="o">=</span> <span class="nb">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;image.png&quot;</span><span class="p">)</span>
<span class="n">stream</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">MemoryInputStream</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">to_slice</span><span class="p">)</span>
<span class="n">texture</span> <span class="o">=</span> <span class="no">SF</span><span class="o">::</span><span class="n">Texture</span><span class="o">.</span><span class="n">from_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</code></pre></div>

<p>Note that the examples above are redundant, because <code>from_file</code> can be used instead. The real use cases are if you want to implement custom loading of resources. Option 1: read from file, extract into memory, use <a href="http://oprypin.github.io/crsfml/api/SF/MemoryInputStream.html">MemoryInputStream</a>. Option 2: implement a custom stream that reads and extracts on the fly.</p>
<h2 id="examples">Examples</h2>
<p>If you need a demonstration that helps you focus on how the code works, and not get lost in implementation details, you could take a look at the implementation of <a href="http://oprypin.github.io/crsfml/api/SF/FileInputStream.html">FileInputStream</a> or <a href="http://oprypin.github.io/crsfml/api/SF/MemoryInputStream.html">MemoryInputStream</a>.</p>
<h2 id="common-mistakes">Common mistakes</h2>
<p>Some resource classes are not loaded completely after <code>from_stream</code> has been called. Instead, they continue to read from their data source as long as they are used. This is the case for <a href="http://oprypin.github.io/crsfml/api/SF/Music.html">Music</a>, which streams audio samples as they are played, and for <a href="http://oprypin.github.io/crsfml/api/SF/Font.html">Font</a>, which loads glyphs on the fly depending on the text that is displayed.</p>
<p>As a consequence, the stream instance that you used to load a music or a font, as well as its data source, must remain alive as long as the resource uses it. If it is destroyed while still being used, it results in undefined behavior (can be a crash, corrupt data, or nothing visible).</p>
<p>Another common mistake is to return whatever the internal functions return directly, but sometimes it doesn't match what SFML expects. For example, some function may return 0 on success, but <code>InputStream#seek</code> expects the actual new position to be returned. Also keep in mind that in case of error -1 must be returned.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../window/window.html" class="btn btn-neutral float-right" title="Opening and managing an SFML window">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="thread.html" class="btn btn-neutral" title="Threads"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/oprypin/crsfml/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="thread.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../window/window.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
